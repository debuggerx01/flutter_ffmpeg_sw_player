# flutter_ffmpeg_sw_player

ä¸€ä¸ªåŸºäº FFmpeg ç®¡é“è¾“å‡ºçš„ Flutter è§†é¢‘è½¯æ¸²æŸ“æ’ä»¶ï¼Œä¸“ä¸ºè§£å†³ Linux å¹³å°ä¸‹è§†é¢‘æ’­æ”¾çš„ç¨³å®šæ€§ä¸ä¾èµ–ç—›ç‚¹è€Œè®¾è®¡ã€‚

## ğŸš€ ä¸ºä»€ä¹ˆé€‰æ‹©æœ¬æ’ä»¶ï¼Ÿ

åœ¨ Linux æ¡Œé¢ç«¯å¼€å‘ä¸­ï¼Œä¼ ç»Ÿçš„æ’­æ”¾å™¨æ–¹æ¡ˆï¼ˆå¦‚ fvp æˆ– media_kitï¼‰è™½ç„¶åŠŸèƒ½å¼ºå¤§ï¼Œä½†åœ¨æŸäº›åœºæ™¯ä¸‹å­˜åœ¨ä»¥ä¸‹æŒ‘æˆ˜ï¼š

1. ç¨³å®šæ€§é—®é¢˜ï¼šåœ¨ Linux ä¸‹ä½¿ç”¨ fvp ç­‰æ’ä»¶é•¿æ—¶é—´æ’­æ”¾è§†é¢‘æµæ—¶ï¼Œå¶ç°åº”ç”¨æ•´ä½“ç•Œé¢å¡æ­»ã€‚
2. ä¾èµ–å¤æ‚ï¼šmedia_kit ç­‰æ–¹æ¡ˆé€šå¸¸æ·±åº¦ä¾èµ– libmpvï¼Œåœ¨éƒ¨åˆ†ç²¾ç®€ç‰ˆ Linux ç³»ç»Ÿä¸­å®‰è£…ä¾èµ–è¾ƒä¸ºç¹çã€‚

flutter_ffmpeg_sw_player é€šè¿‡ç›´æ¥è°ƒç”¨ FFmpeg è¿›ç¨‹å¹¶è§£æå…¶æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼‰çš„åŸå§‹è§†é¢‘å¸§è¿›è¡Œæ¸²æŸ“ï¼Œé¿å¼€äº†å¤æ‚çš„ C/C++ åº“æ·±åº¦é“¾æ¥ï¼Œæä¾›äº†ä¸€ä¸ªæ›´è½»é‡ã€æ›´ç¨³å®šçš„æ›¿ä»£æ–¹æ¡ˆã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

* ä½ä¾èµ–ï¼šåªéœ€ç³»ç»Ÿç¯å¢ƒä¸­æœ‰ ffmpeg æ‰§è¡Œæ–‡ä»¶å³å¯å·¥ä½œï¼Œæ— éœ€å®‰è£…å¤æ‚çš„å¼€å‘å¤´æ–‡ä»¶æˆ–åº“ã€‚
* é«˜ç¨³å®šæ€§ï¼šåˆ©ç”¨ç‹¬ç«‹çš„å­è¿›ç¨‹è§£ç ï¼Œå³ä¾¿è§£ç å‡ºç°å¼‚å¸¸ä¹Ÿä¸ä¼šå¯¼è‡´ Flutter ä¸»è¿›ç¨‹å¡æ­»ã€‚
* çµæ´»æ¸²æŸ“ï¼š
    * æ”¯æŒ Texture æ¨¡å¼ï¼šåˆ©ç”¨çº¹ç†å…±äº«æé«˜æ¸²æŸ“æ•ˆç‡ã€‚
    * æ”¯æŒ RawImage æ¨¡å¼ï¼šä¸ä¾èµ– GPU çº¹ç†ï¼Œçº¯è½¯ç»˜å…¼å®¹æ€§æ›´ä½³ã€‚
* å¤šå®ä¾‹æ”¯æŒï¼šè½»æ¾å®ç°è§†é¢‘å¢™ç›‘æ§ç­‰åœºæ™¯ã€‚

## âš ï¸ é™åˆ¶è¯´æ˜ (Limitations)

ç”±äºå…¶å®ç°æœºåˆ¶çš„ç‰¹æ®Šæ€§ï¼Œæœ¬æ’ä»¶ä¸é€‚åˆæ‰€æœ‰åœºæ™¯ï¼š

1. æ— éŸ³é¢‘æ’­æ”¾ï¼šæ’ä»¶ç›®å‰ä»…å¤„ç†è§†é¢‘æµï¼Œä¸æä¾›å£°éŸ³è¾“å‡ºã€‚
2. ç¼ºå°‘ Seek åŠŸèƒ½ï¼šç›®å‰ä»…æ”¯æŒæµå¼é¡ºåºæ’­æ”¾ï¼Œä¸æ”¯æŒè·³è½¬è¿›åº¦ã€‚
3. æ€§èƒ½å¼€é”€ï¼šé‡‡ç”¨è½¯ä»¶è§£ç å’Œæ•°æ®æ‹·è´ï¼ŒCPU å ç”¨ç‡ä¼šé«˜äºç¡¬ä»¶è§£ç æ–¹æ¡ˆï¼Œä¸å»ºè®®ç”¨äº 4K ç­‰è¶…é«˜æ¸…è§†é¢‘ã€‚

## ğŸ“¦ å®‰è£…ä¸é…ç½®

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨çš„ Linux ç³»ç»Ÿä¸­å·²å®‰è£… ffmpegã€‚

```bash
sudo apt install ffmpeg
```

æˆ–è€…åœ¨ä»£ç ä¸­æ‰‹åŠ¨æŒ‡å®š ffmpeg çš„äºŒè¿›åˆ¶è·¯å¾„ï¼š

```dart
FfmpegUtil.setBinaryPath('/path/to/your/ffmpeg');
```
> ç»æµ‹è¯•ï¼Œffmpeg v6.1ç‰ˆæœ¬åœ¨äºŒè¿›åˆ¶æ–‡ä»¶å°ºå¯¸å’Œæ€§èƒ½æ–¹é¢è¡¨ç°å‡ºè‰²ï¼Œå»ºè®®ä»å¦‚ä¸‹åœ°å€ä¸‹è½½é™æ€ç¼–è¯‘çš„ç‰ˆæœ¬ï¼š[FFmpeg-Builds -- Auto-Build 2025-08-31](https://github.com/BtbN/FFmpeg-Builds/releases/tag/autobuild-2025-08-31-13-00)
> 
> x64: https://github.com/BtbN/FFmpeg-Builds/releases/download/autobuild-2025-08-31-13-00/ffmpeg-n6.1.3-linux64-lgpl-6.1.tar.xz
> 
> arm64: https://github.com/BtbN/FFmpeg-Builds/releases/download/autobuild-2025-08-31-13-00/ffmpeg-n6.1.3-linuxarm64-lgpl-6.1.tar.xz
> 
> ä¸‹è½½åè§£å‹è·å– `bin/ffmpeg`ï¼Œå¯ä»¥è€ƒè™‘å°†å…¶æ”¾åœ¨é¡¹ç›®çš„assetsä¸­ï¼Œåº”ç”¨å¯åŠ¨æ—¶å°†å…¶æå–é‡Šæ”¾åˆ°ç”¨æˆ·ç›®å½•ï¼Œé€šè¿‡`Process.runSync('chmod', ['u+x', '/path/to/your/ffmpeg']);`èµ‹äºˆæ‰§è¡Œæƒé™ï¼Œæœ€åå°†è¯¥è·¯å¾„ä¼ é€’ç»™`FfmpegUtil.setBinaryPath`å³å¯ã€‚

### 2. æ·»åŠ ä¾èµ–

å°†æ­¤æ’ä»¶æ·»åŠ åˆ°æ‚¨çš„ pubspec.yaml ä¸­ã€‚

## ğŸ› ï¸ å¿«é€Ÿå¼€å§‹

### åŸºç¡€ç”¨æ³•

```dart
import 'package:flutter_ffmpeg_sw_player/flutter_ffmpeg_sw_player.dart';

// 1. åˆ›å»ºæ§åˆ¶å™¨
final controller = FfmpegPlayerController();

// 2. å¼€å§‹æ’­æ”¾
controller.play(
  'https://example.com/video.mp4',
  onProgress: (pos) => print('å½“å‰è¿›åº¦: $pos'),
  onComplete: () => print('æ’­æ”¾å®Œæˆ'),
);


// 3. åœ¨ UI ä¸­æ˜¾ç¤º
@override
Widget build(BuildContext context) {
  return FfmpegPlayerView(
    controller: controller,
    fit: BoxFit.contain,
    useTextureRender: true, // æ˜¯å¦ä½¿ç”¨çº¹ç†åŠ é€Ÿ
  );
}

// 4. é”€æ¯
@override
void dispose() {
  controller.dispose();
  super.dispose();
}
```

## ğŸ® æ§åˆ¶å™¨ API

| æ–¹æ³•/å±æ€§                               | è¯´æ˜                                                                           |
|:------------------------------------|:-----------------------------------------------------------------------------|
| play(path, {loop, onProgress, ...}) | å¼€å§‹æ’­æ”¾è§†é¢‘æ–‡ä»¶æˆ–ç½‘ç»œæµ                                                                 |
| stop()                              | åœæ­¢æ’­æ”¾å¹¶é‡ç½®çŠ¶æ€                                                                    |
| togglePlay()                        | åˆ‡æ¢ æš‚åœ/æ’­æ”¾ çŠ¶æ€                                                                  |
| status                              | ValueNotifier<PlayerStatus> ç›‘å¬æ’­æ”¾å™¨çŠ¶æ€ (idle, loading, playing, pausing, error) |
| dispose()                           | é‡Šæ”¾èµ„æºï¼Œå…³é—­ FFmpeg è¿›ç¨‹                                                            |

## ğŸ¤ è´¡çŒ®ä¸åé¦ˆ

å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œæˆ–è€…æœ‰æ›´å¥½çš„æ”¹è¿›å»ºè®®ï¼Œæ¬¢è¿æäº¤ Issue æˆ– Pull Requestã€‚

---

æ³¨æ„ï¼šæœ¬æ’ä»¶ä¸»è¦é’ˆå¯¹ Linux å¹³å°å¼€å‘æµ‹è¯•ï¼Œwindowså’Œmacç†è®ºä¸Šä¹Ÿæ”¯æŒï¼Œè¯·è‡ªè¡Œæµ‹è¯•ã€‚
